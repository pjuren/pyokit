<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Processing BED files &mdash; Pyokit 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Pyokit 0.2.0 documentation" href="index.html" />
    <link rel="up" title="Genomic Intervals" href="genomicIntervals.html" />
    <link rel="next" title="Manipulating Genomic Intervals" href="genomicIntervals_manip.html" />
    <link rel="prev" title="Genomic Intervals" href="genomicIntervals.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="genomicIntervals_manip.html" title="Manipulating Genomic Intervals"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="genomicIntervals.html" title="Genomic Intervals"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Pyokit 0.2.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="using.html" >Using Pyokit</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="genomicIntervals.html" accesskey="U">Genomic Intervals</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="processing-bed-files">
<h1>Processing BED files<a class="headerlink" href="#processing-bed-files" title="Permalink to this headline">¶</a></h1>
<p>Pyokit has a number of classes and functions for processing BED files, which are
plain-text files containing genomic intervals. There are basically two approches
for processing them in Pyokit: iterate over the BED file, which provides access
to one (or a small subset of) genomic interval at a time without storing the
whole file in memory, or bulk-load them into some data structure. Both
approaches are covered below. Pyokit also contains facilities for processing
multiple BED files simultaneously with the intention of finding matching or
missing entries in one or more of the files. Examples of this are also given
below.</p>
<p>You can find the definition of the BED format here:
<a class="reference external" href="http://genome.ucsc.edu/FAQ/FAQformat.html#format1">http://genome.ucsc.edu/FAQ/FAQformat.html#format1</a></p>
<div class="section" id="iterating-over-bed-files">
<h2>Iterating over BED files<a class="headerlink" href="#iterating-over-bed-files" title="Permalink to this headline">¶</a></h2>
<p>If you only need sequential access to the genomic intervals in a BED file, then
this is the best approach &#8211; memeory usage will be O(1).</p>
<div class="section" id="the-basic-bed-iterator">
<h3>The basic BED iterator<a class="headerlink" href="#the-basic-bed-iterator" title="Permalink to this headline">¶</a></h3>
<p>This is the basic iterator, and will be sufficient in most situations. The
usual idiom would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyokit.io.bedIterators</span> <span class="kn">import</span> <span class="n">BEDIterator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">BEDIterator</span><span class="p">(</span><span class="n">myFile</span><span class="p">)</span> <span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="c"># e is a GenomicInterval object.</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="c"># Do whatever you want with it here.</span>
</pre></div>
</div>
<p>Here&#8217;s the signature of the basic BED iterator function:</p>
<dl class="function">
<dt id="pyokit.io.bedIterators.BEDIterator">
<code class="descclassname">pyokit.io.bedIterators.</code><code class="descname">BEDIterator</code><span class="sig-paren">(</span><em>filehandle</em>, <em>sortedby=None</em>, <em>verbose=False</em>, <em>scoreType=&lt;type 'int'&gt;</em>, <em>dropAfter=None</em><span class="sig-paren">)</span><a class="headerlink" href="#pyokit.io.bedIterators.BEDIterator" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an iterator for a BED file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>filehandle</strong> &#8211; this can be either a string, or a stream-like object. In
the former case, it is treated as a filename. The format
of the file/stream must be BED.</li>
<li><strong>sortedby</strong> &#8211; if None, order is not checked.
if == ITERATOR_SORTED_START, elements in file must
be sorted by chrom and start index (an exception
is raised if they are not)
if == ITERATOR_SORTED_END, element must be sorted
by chrom and end index.</li>
<li><strong>verbose</strong> &#8211; if True, output additional progress messages to stderr</li>
<li><strong>scoreType</strong> &#8211; The data type for scores (the fifth column) in the BED
file.</li>
<li><strong>dropAfter</strong> &#8211; an int indicating that any fields after and including this
field should be ignored as they don&#8217;t conform to the BED
format. By default, None, meaning we use all fields. Index
from zero.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">iterator where subsequent calls to next() yield the next BED
element in the stream as a GenomicInterval object.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="the-paired-bed-iterator">
<h3>The paired BED iterator<a class="headerlink" href="#the-paired-bed-iterator" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may want to iterate over multiple BED files at the same time.
That&#8217;s what the paired BED iterator is for. You can either ignore intervals
that don&#8217;t exist in all of the BED files (the default), or you can populate
missing intervals on-the-fly with a default. By deault, intervals are considered
to match if they have the same chromosome, start and end index, and strand.
Which fields are used for matching can be adjusted though. Here&#8217;s an example of
using the iterator to find all the matching intervals in a set of BED files.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">izip</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyokit.io.bedIterators</span> <span class="kn">import</span> <span class="n">pairedBEDIterator</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;one.bed&quot;</span><span class="p">,</span><span class="s">&quot;two.bed&quot;</span><span class="p">,</span><span class="s">&quot;three.bed&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">pairedBEDIterator</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span> <span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="c"># each element yielded by the iterator will be a list of GenomicInterval</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="c"># objects; the index in the list will match the index of the filename that</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="c"># the interval came from. The chrom, start and end will always match</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">chrom</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">chrom</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">start</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">start</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">end</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">end</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chrom</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">chrom</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chrom</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">start</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">end</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">end</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">msgs</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot; in &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
<span class="gp">&gt;&gt;&gt; </span>                    <span class="n">izip</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">],</span> <span class="n">filenames</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="k">print</span> <span class="s">&quot;region at &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">chrom</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span>\
<span class="gp">&gt;&gt;&gt; </span>        <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; has name &quot;</span> <span class="o">+</span> <span class="n">msgs</span>
</pre></div>
</div>
<p>Given the following contents of <code class="docutils literal"><span class="pre">one.bed</span></code>, <code class="docutils literal"><span class="pre">two.bed</span></code> and <code class="docutils literal"><span class="pre">three.bed</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat one.bed
chr1  <span class="m">10</span>      <span class="m">20</span>      reg1    <span class="m">1</span>       +
chr1  <span class="m">40</span>      <span class="m">50</span>      reg2    <span class="m">2</span>       -
<span class="nv">$ </span>cat two.bed
chr1  <span class="m">10</span>      <span class="m">20</span>      regA    <span class="m">1</span>       +
chr1  <span class="m">30</span>      <span class="m">35</span>      regB    <span class="m">5</span>       -
chr1  <span class="m">40</span>      <span class="m">50</span>      regC    <span class="m">2</span>       -
chr2  <span class="m">10</span>      <span class="m">20</span>      regD    <span class="m">2</span>       +
<span class="nv">$ </span>cat three.bed
chr1  <span class="m">10</span>      <span class="m">20</span>      regW    <span class="m">1</span>       +
chr1  <span class="m">30</span>      <span class="m">35</span>      regX    <span class="m">5</span>       -
chr1  <span class="m">40</span>      <span class="m">50</span>      regY    <span class="m">2</span>       -
chr2  <span class="m">10</span>      <span class="m">20</span>      regZ    <span class="m">2</span>       +
</pre></div>
</div>
<p>The output of the above script would be:</p>
<div class="highlight-bash"><div class="highlight"><pre>region at chr1 <span class="m">10</span> <span class="m">20</span> has name reg1 in one.bed, regA in two.bed, regW in three.bed
region at chr1 <span class="m">40</span> <span class="m">50</span> has name reg2 in one.bed, regC in two.bed, regY in three.bed
</pre></div>
</div>
<p>Here&#8217;s the signature of the paired BED iterator function:</p>
<dl class="function">
<dt id="pyokit.io.bedIterators.pairedBEDIterator">
<code class="descclassname">pyokit.io.bedIterators.</code><code class="descname">pairedBEDIterator</code><span class="sig-paren">(</span><em>inputStreams</em>, <em>mirror=False</em>, <em>mirrorScore=None</em>, <em>ignoreStrand=False</em>, <em>ignoreScore=True</em>, <em>ignoreName=True</em>, <em>sortedby=2</em>, <em>scoreType=&lt;type 'float'&gt;</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#pyokit.io.bedIterators.pairedBEDIterator" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over multiple BED format files simultaneously and yield lists of
genomic intervals for each matching set of intervals found. By default,
regions which are not found in all files will be skipped (mirror = false).
Optionally (by setting mirror to true) if a file is missing an interval,
it can be added on-the-fly, and will have the same chrom, start and end and
name as in other files. The score will be taken from the first file in
inputStreams if mirrorScore is not set, otherwise that value will be used.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>inputStreams</strong> &#8211; a list of input streams in BED format</li>
<li><strong>mirror</strong> &#8211; if true, add missing elements so all streams contain the
same elements. Inserted elements will have the same</li>
<li><strong>ignoreStrand</strong> &#8211; ignore strand when comparing elements for equality?</li>
<li><strong>ignoreScore</strong> &#8211; ignore score when comparing elements for equality?</li>
<li><strong>ignoreScore</strong> &#8211; ignore name when comparing elements for equality?</li>
<li><strong>sortedby</strong> &#8211; must be set to one of the sorting orders for BED streams;
we require the streams to be sorted in some fashion.</li>
<li><strong>scoreType</strong> &#8211; interpret scores as what type? Defaults to float, which
is generally the most flexible.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="bulk-loading-bed-files">
<h2>Bulk-loading BED files<a class="headerlink" href="#bulk-loading-bed-files" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you&#8217;ll need to load all of the intervals in a BED file, generally
when you need random-access to them (rather than sequential). It&#8217;s easy to load
them into a list (see below), but this isn&#8217;t practical if you&#8217;re trying to
look up intervals that fall within a certain part of the genome. An easy way to
do that is to load them into an interval tree, which then allows O(log(n)) time
to find intervals (instead of O(n) for checking a list).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this isn&#8217;t neccessarily the fastest way to do this; depending on what
you&#8217;re doing, it may be faster to sort your BED files beforehand and
then iterate over them simultaneously. Still, interval trees are easy
and I find they&#8217;re usually fast enough in practice.</p>
</div>
<div class="section" id="loading-into-a-list">
<h3>Loading into a list<a class="headerlink" href="#loading-into-a-list" title="Permalink to this headline">¶</a></h3>
<p>The easiest way to do this is to use any of the above iterators and populate a
list, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">allMyRegions</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">BEDIterator</span><span class="p">(</span><span class="n">fn</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-into-an-interval-tree">
<h3>Loading into an interval tree<a class="headerlink" href="#loading-into-an-interval-tree" title="Permalink to this headline">¶</a></h3>
<p>the <cite>intervalTrees</cite> function will load a BED file and return a dictionary of
interval trees. The keys to the dictionary are chromosome names, and each
entry is an interval tree for that chromosome. For details about the interval
tree objects, see <a class="reference internal" href="datastrct.html#intervaltreessection"><span>Interval Trees</span></a>.</p>
<dl class="function">
<dt id="pyokit.io.bedIterators.intervalTrees">
<code class="descclassname">pyokit.io.bedIterators.</code><code class="descname">intervalTrees</code><span class="sig-paren">(</span><em>reffh</em>, <em>scoreType=&lt;type 'int'&gt;</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#pyokit.io.bedIterators.intervalTrees" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a dictionary of interval trees indexed by chrom from a BED stream or
file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>reffh</strong> &#8211; This can be either a string, or a stream-like object. In the
former case, it is treated as a filename. The format of the
file/stream must be BED.</li>
<li><strong>scoreType</strong> &#8211; The data type for scores (the fifth column) in the BED
file.</li>
<li><strong>verbose</strong> &#8211; output progress messages to sys.stderr if True</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Processing BED files</a><ul>
<li><a class="reference internal" href="#iterating-over-bed-files">Iterating over BED files</a><ul>
<li><a class="reference internal" href="#the-basic-bed-iterator">The basic BED iterator</a></li>
<li><a class="reference internal" href="#the-paired-bed-iterator">The paired BED iterator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bulk-loading-bed-files">Bulk-loading BED files</a><ul>
<li><a class="reference internal" href="#loading-into-a-list">Loading into a list</a></li>
<li><a class="reference internal" href="#loading-into-an-interval-tree">Loading into an interval tree</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="genomicIntervals.html"
                        title="previous chapter">Genomic Intervals</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="genomicIntervals_manip.html"
                        title="next chapter">Manipulating Genomic Intervals</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/bed.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="genomicIntervals_manip.html" title="Manipulating Genomic Intervals"
             >next</a> |</li>
        <li class="right" >
          <a href="genomicIntervals.html" title="Genomic Intervals"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Pyokit 0.2.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="using.html" >Using Pyokit</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="genomicIntervals.html" >Genomic Intervals</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Philip J. Uren.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>